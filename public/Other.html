<div data-role="appviewpage" data-title="List of Employees">
    <div data-role="content">

<script id="chartscript" type="text/javascript">
      //  $.support.cors = true;
    // var employees = $.get("http://localhost:3000/data2");
function makeArrayOf(value, length) {
  var arr = [], i = length;
  while (i--) {
    arr[i] = value;
  }
  return arr;
}

$.get("http://localhost:3000/data2",
       function(data) {

var fullList = [];
var nameUsage = [];
var barNameList = [];
var usageList = [];
var barChartList = {};
var barServiceList = [];
var serviceFlag = 0;
for (var i = 0, len = data.length; i < len; i++) {
    var result = data[i];
    fullList.push({ name: result.name, service: result.service, policy: result.policy, usage: result.usage });
    nameUsage.push({ name: result.name, usage: result.usage });
    usageList.push(result.usage);

    if (barServiceList.indexOf(result.service) == -1) //NEW SERVICE
     {
       if (barNameList.indexOf(result.name) == -1) //NEW SERVICE, NEW NAME
        {  
            barServiceList.push(result.service);
            barNameList.push(result.name);
            barChartList[result.service] = {};
            barChartList[result.service].label = result.service;
            barChartList[result.service].legendEntry = true;
            barChartList[result.service].data = {y : []};
            barChartList[result.service].data.y = makeArrayOf(0, barNameList.length -1);
            

            var x=0;
            var txt="";
            for (x in barChartList)
            {
            barChartList[x].data.y.push(0);
            }
        
            barChartList[result.service].data.y[barNameList.indexOf(result.name)] = result.usage;

        }         
        else //NEW SERVICE, OLD NAME
        {
            barServiceList.push(result.service);
            barChartList[result.service] = {};
            barChartList[result.service].label = result.service;
            barChartList[result.service].legendEntry = true;
            barChartList[result.service].data = {y : []};
            barChartList[result.service].data.y = makeArrayOf(0, barNameList.length);  

            barChartList[result.service].data.y[barNameList.indexOf(result.name)] = result.usage;
          
        }
     }
     else //OLD SERVICE
     {
      if (barNameList.indexOf(result.name) == -1) //OLD SERVICE, NEW NAME        
        { 
            barNameList.push(result.name);

            var x=0;
            var txt="";
            for (x in barChartList)
            {
            barChartList[x].data.y.push(0);
            }
        
            barChartList[result.service].data.y[barNameList.indexOf(result.name)] = result.usage;
        }
        else //OLD SERVICE, OLD NAME
        {
        
            barChartList[result.service].data.y[barNameList.indexOf(result.name)] = result.usage;
 
        }
     }

}// END OF FOR LOOP

var barChartListArray = [];
var barChartNameList = {x : barNameList};
var x=0;
var txt="";
for (x in barChartList)
{
barChartListArray.push(barChartList[x]);
}

$("#barchart1").wijbarchart({
                axis: {
                    y: {
                        text: "Used Data (MB)"
                    },
                    x: {
                        text: ""
                    }
                },
                hint: {
                    content: function () {
                        return this.x + '\n ' + this.y + '';
                    }
                },
                header: {
                    text: "Service usage"
                },
                data : barChartNameList,
                seriesList: barChartListArray,
                seriesStyles: [{
                    fill: "#8ede43", stroke: "#7fc73c", opacity: 0.8
                }],
                seriesHoverStyles: [{ "stroke-width": "1.5", opacity: 1
                }]
            });

}, "json");


</script>

<div class="container">
    <div class="header">
    </div>
    <div class="main demo">
        <!-- Begin demo markup -->

     <div id="barchart1" class="ui-widget ui-widget-content
       ui-corner-all" style="width: 400px; height: 300px">
     </div>
</div>   

     
     </div>
</div>